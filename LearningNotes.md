# Learning Notes

This document listed the notes when building the apps.

## `angular.json`

`angular.json` used to control the setup of the project.

### Builder Architecture

`ng build` only executes the builder for the `build` target in the default project as specified in `angular.json`. 

|Builder|Purpose|
|--|--|
|@angular-devkit/build-angular:browser|Bundles a client-side application for use in a browser with Webpack.|
|@angular-devkit/build-angular:browser-esbuild|Bundles a client-side application for use in a browser with esbuild. See browser-esbuild documentation for more information.|
|@angular-devkit/build-angular:application|Builds an application with a client-side bundle, a Node server, and build-time prerendered routes with esbuild.|
|@angular-devkit/build-angular:ng-packagr|Builds an Angular library adhering to Angular Package Format.|

Applications generated by `ng new` use `@angular-devkit/build-angular:application` by default. Libraries generated by `ng generate` library use `@angular-devkit/build-angular:ng-packagr` by default.

```json
{
  "projects": {
    "my-app": {
      "architect": {
        // `ng build` invokes the Architect target named `build`.
        "build": {
          "builder": "@angular-devkit/build-angular:application",
          …
        },
        "serve": { … }
        "test": { … }
        …
      }
    }
  }
}
```

### Serving

`ng serve` only executes the builder for the serve target in the default project as specified in `angular.json`. While any `builder` can be used here, the most common (and default) builder is `@angular-devkit/build-angular:dev-server`.

```json
{
  "projects": {
    "my-app": {
      "architect": {
        // `ng serve` invokes the Architect target named `serve`.
        "serve": {
          "builder": "@angular-devkit/build-angular:dev-server",
          // ...
        },
        "build": { /* ... */ }
        "test": { /* ... */ }
      }
    }
  }
}
```

#### Proxying to backend server

Use `proxying support` to divert certain URLs to a backend server, by passing a file to the `--proxy-config` build option. For example, to divert all calls for `http://localhost:4200/api` to a server running on `http://localhost:3000/api`, take the following steps.

1. Create a file `proxy.conf.json` in your project's `src/` folder.

2. Add the following content to the new proxy file:

```json
{
   "/api": {
     "target": "http://localhost:3000",
     "secure": false
   }
}
```

3. In the CLI configuration file, `angular.json`, add the `proxyConfig` option to the serve target:

```json
{
   "projects": {
     "my-app": {
       "architect": {
         "serve": {
           "builder": "@angular-devkit/build-angular:dev-server",
           "options": {
             "proxyConfig": "src/proxy.conf.json"
           }
         }
       }
     }
   }
}
```

To run the development server with this proxy configuration, call `ng serve`.

### Source map

Config the `Source map`:

```json
{
  "projects": {
    "my-app": {
      "architect": {
        "build": {
          "builder": "@angular-devkit/build-angular:browser",
          "options": {
            // By default, disable source map generation.
            "sourceMap": false
          },
          "configurations": {
            // For the `debug` configuration, enable source maps.
            "debug": {
              "sourceMap": true
            }
          }
        },
        …
      }
    }
  }
}
```

### Environment variable

Using `ng generate environments` to create the `src/environments/` directory and configure the project to use file replacements.

And `angular.json` to add `fileReplacements`:   

```json
"configurations": {
    "development": { … },
    "production": { … },
    "staging": {
      "fileReplacements": [
        {
          "replace": "src/environments/environment.ts",
          "with": "src/environments/environment.staging.ts"
        }
      ]
    }
  }
```

### Config the bundle size

During project initialization, `angular.json` will ship default setup for bundle size.

```json
{
  …
  "configurations": {
    "production": {
      …
      "budgets": [
        {
          "type": "initial",
          "maximumWarning": "250kb",
          "maximumError": "500kb"
        },
      ]
    }
  }
}
```

Allowed list of the `type`:

|Value|Details|
|--|----|
|bundle|The size of a specific bundle.|
|initial|The size of JavaScript needed for bootstrapping the application. Defaults to warning at 500kb and erroring at 1mb.|
|allScript|The size of all scripts.|
|all|The size of the entire application.|
|anyComponentStyle|This size of any one component stylesheet. Defaults to warning at 2kb and erroring at 4kb.|
|anyScript|The size of any one script.|
|any|The size of any file.|

### Config CommonJS dependencies

Angular perfer native ECMAScript module throughout your application and its dependencies. Though Angular also support CommonJS, it can making your bundle larger.

```json
"build": {
  "builder": "@angular-devkit/build-angular:browser",
  "options": {
     "allowedCommonJsDependencies": [
        "lodash"
     ]
     …
   }
   …
},
```

### Config browser compatibility

Use `ng generate config browserslist` to generate `.browserslistrc` configurateion file.

```
last 2 Chrome versions
last 1 Firefox version
last 2 Edge major versions
last 2 Safari major versions
last 2 iOS major versions
Firefox ESR
```

### Customer builder

A number of Angular CLI commands run a complex process on your code, such as building, testing, or serving your application. The commands use an internal tool called `Architect` to run CLI builders, which invoke another tool (bundler, test runner, server) to accomplish the desired task. `Custom builders` can perform an entirely new task, or to change which third-party tool is used by an existing command.

Refer to [Official Document](https://angular.dev/tools/cli/cli-builder).

